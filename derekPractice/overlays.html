<!DOCTYPE html>
<html>
  <head>
    <title>Drawing tools</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
      html, body, #map-canvas{
        height: 100%;
        margin: 0px;
        padding: 0px
      }
      #map-canvas{
      	width: 50%;
      	display: inline-block;
      }
      #eventFormDiv{
      	height: 100%;
      	width: 48%;
      	display: inline-block;
      	background-color:#008000;
      	vertical-align: top;
      	margin: 0px;
      	padding: 0px;
      }
      #postText{
      	width: 80%;
      	height: 300px;
      	
      }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=drawing"></script>
    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
	<script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script>
    var drawingManager;
    var drawingsArray = [];
    var drawingsCount = -1;
    var loginName = 'testUser';
    var map;
    var mapOptions;
    
    
function initialize() {
  mapOptions = {
    center: new google.maps.LatLng(-34.397, 150.644),
    zoom: 8
  };


  map = new google.maps.Map(document.getElementById('map-canvas'),
    mapOptions);

  drawingManager = new google.maps.drawing.DrawingManager({
    drawingMode: google.maps.drawing.OverlayType.MARKER,
    drawingControl: true,
    drawingControlOptions: {
      position: google.maps.ControlPosition.TOP_CENTER,
      drawingModes: [
        google.maps.drawing.OverlayType.MARKER,
        //google.maps.drawing.OverlayType.CIRCLE,
        google.maps.drawing.OverlayType.POLYGON,
        google.maps.drawing.OverlayType.POLYLINE,
        //google.maps.drawing.OverlayType.RECTANGLE
      ]
    },
    markerOptions: {
      icon: 'flagPoint.jpg',
    },
    circleOptions: {
      fillColor: '#ffff00',
      fillOpacity: 0.5,
      strokeWeight: 2,
      clickable: false,
      editable: true,
      zIndex: 1
    },
    polygonOptions: {
		//path:myTrip,
  		strokeColor:"#0000FF",
  		strokeOpacity:0.8,
  		strokeWeight:2,
  		fillColor:"#0000FF",
  		fillOpacity:0.4
    }
  });
 
  drawingManager.setMap(map);
  $('#eventFormForm').hide();
  //After creating 'drawingManager' object in if block 
  google.maps.event.addListener(drawingManager, 'overlaycomplete', function(event) {
	//this was the original code example I got from:
	///(http://stackoverflow.com/questions/9853861/getting-list-of-overlay-shapes-currently-on-a-google-map-api-v3)
      /*if (event.type == google.maps.drawing.OverlayType.CIRCLE) {
         //Add 'event.overlay', which is Circle, to array
         drawingsArray.push(event.overlay);
      }*/
     //I altered it to a switch statement to get all of our shapes
     switch(event.type)
     {
     	/*case google.maps.drawing.OverlayType.CIRCLE:
     	var newOv = event.overlay;
     	var newPath = newOv.getPath();
     	var encPath = google.maps.geometry.encoding.encodePath(newPath);
     	drawingsArray.push({
     		eventGroup: loginName,
     		eventTime: null,
     		eventCategory: null,
     		eventOverlay: event.overlay,
     		eventShape: 'circle',
     		eventTitle: null,
     		eventEncodedPath: newPath,
     	});
     	drawingsCount++;
     	break;*/
     	case google.maps.drawing.OverlayType.MARKER:
     	var newOv = event.overlay;
     	var newPos = newOv.getPosition();
     	var posArr = [];
     	var newLatLng = new google.maps.LatLng(newPos.k,newPos.A);
     	posArr.push(newLatLng);
     	var encPos = google.maps.geometry.encoding.encodePath(posArr);
     	drawingsArray.push({
     		eventGroup: loginName,
     		eventStart: null,
     		eventEnd: null,
     		eventCategory: null,
     		eventColor: null,
     		eventOverlay: event.overlay,
     		eventShape: 'marker',
     		eventTitle: null,
     		eventGeometry: encPos,
     	});
 		drawingsCount++;
     	break;
     	case google.maps.drawing.OverlayType.POLYGON:
     	var newOv = event.overlay;
     	var newPath = newOv.getPath();
     	var encPath = google.maps.geometry.encoding.encodePath(newPath);
     	drawingsArray.push({
     		eventGroup: loginName,
     		eventStart: null,
     		eventEnd: null,
     		eventCategory: null,
     		eventColor: null,
     		eventOverlay: event.overlay,
     		eventShape: 'polygon',
     		eventTitle: null,
     		eventGeometry: encPath,
     	});
     	drawingsCount++;
     	break;
     	case google.maps.drawing.OverlayType.POLYLINE:
     	var newOv = event.overlay;
     	var newPath = newOv.getPath();
     	var encPath = google.maps.geometry.encoding.encodePath(newPath);
     	drawingsArray.push({
     		eventGroup: loginName,
     		eventStart: null,
     		eventEnd: null,
     		eventCategory: null,
     		eventColor: null,
     		eventOverlay: event.overlay,
     		eventShape: 'polyline',
     		eventTitle: null,
     		eventGeometry: encPath,
     	});
     	drawingsCount++;
     	break;
     	/*case google.maps.drawing.OverlayType.RECTANGLE:
     	drawingsArray.push({
     		eventGroup: loginName,
     		eventTime: null,
     		eventCategory: null,
     		eventOverlay: event.overlay,
     		eventShape: 'rectangle',
     		eventTitle: null
     	});
     	drawingsCount++;
     	break;*/
     }
     //then I wrote this to bring up a form to make more additions to the event
     showEventForm();
  });

} 

function showEventForm(){
	$('#eventFormForm').show();
	$('#group').val(loginName);
	var geom = drawingsArray[drawingsCount].eventShape;
	$('#geometry').val(geom);
}
google.maps.event.addDomListener(window, 'load', initialize);

/*write function which accepts a collection array of this type and creates all of the map overlays
 * name
 * color
 * user
 * events
 * 
 * where events is an array of event objects of this type:
 * name
 * shape
 * geometry
 * start
 * end
 */
function drawCollection(collectionArray){ //? is this supposed to handle an array of collections or just one collection?
	//set variables for the collection
	var collName = collectionArray[0];
	var collColor = collectionArray[1];
	var collUser = collectionArray[2];
	var collEvents = collectionArray[3]; //this is an array of events
	//now draw each event in the collection
	for (var i=0; i<collEvents.length; i++){
		var evtName = collEvents[i].name;
		var evtShape = collEvents[i].shape;
		var evtStart = collEvents[i].start;
		var evtEnd = collEvents[i].end;
		//decode the geometry
		var evtGeometry = collEvents[i].geometry;
		var decodedGeom = google.maps.geometry.encoding.decodePath(evtGeometry);
		//draw event-i
		var eventi;
		switch(evtShape){
			case 'marker':
			//do it here
			eventi = new google.maps.Polyline({
				map: map,
				//the position is a special case here. The markers have an array of only one item which is a LatLng google maps object
				//the markers do not accept an array for the position like the polyline and polygon so you need to refer to the LatLng
				//object directly which is index 0.
				position: decodedGeom[0],
				title: evtName,
				collection: collName,
				user: collUser,
				start: evtStart,
				end: evtEnd,
			});
			break;
			case 'polygon':
			//draw it
			eventi = new google.maps.Polyline({
				map: map,
				//the polygon overlays accept an array of LatLng google maps objects for the path
				//the polygon uses paths incase there are more than one. If only one array of LatLng objects 
				//exists you could put the array in the paths or path attribute and it wouldn't matter
				//we use paths make sure we are correct in either instance.
				paths: decodedGeom,
				geodesic: true,
				strokeColor: collColor,
				fillColor: collColor,
				strokeOpacity: 1.0,
				fillOpacity: 0.5,
				strokeWeight: 2.0,
				title: evtName,
				collection: collName,
				user: collUser,
				start: evtStart,
				end: evtEnd,
			});
			break;
			case 'polyline':
			//draw it
			eventi = new google.maps.Polyline({
				map: map,
				//this is similar to the paths attribute in the polygons. See above.
				path: decodedGeom,
				geodesic: true,
				strokeColor: collColor,
				strokeOpacity: 1.0,
				strokeWeight: 2.0,
				title: evtName,
				collection: collName,
				user: collUser,
				start: evtStart,
				end: evtEnd,
			});
			break;
			default:
			//do something else to show that the geometry was not recognized
		}
	}
}


/*
 * write a function to send event information with this data:
 * name: string
 * content: string
 * shape
 * geometry; coded
 * start
 * end
 * collection 
 * color: --this only is null unless it is a new event
 */
    </script>
  </head>
  <body>
    <div id="map-canvas">
    	<!--map goes here-->
    </div>
    <div id="eventFormDiv">
    	<form id="eventFormForm">
    		<label for="group">Login: </label>
    		<input type="text" id="group" /><br />
    		<label for="title">Event Title: </label>
    		<input type="text" id="title" /><br />
    		<label for="time">Date/Time: </label>
    		<input type="datetime" id="time"/><br />
    		<label for="geometry">Event Geometry: </label>
    		<select id="geometry">
    			<option value="prompt">Please Select A Geometry</option>
    			<option value="circle">circle</option>
    			<option value="marker">marker</option>
    			<option value="polyline">polyline</option>
    			<option value="polygon">polygon</option>
    			<option value="rectangle">rectangle</option>
    			<option value="none">none</option>
    		</select>
    		<label for="category">Category: </label>
    		<select id="category">
    			<option value="prompt">Please Select A Category</option>
    			<option value="cat1">category 1</option>
    			<option value="cat2">category 2</option>
    			<option value="cat3">category 3</option>
    			<option value="new">NEW</option>
    		</select>
    		<input type="text" /><br />
    		<label for="postText">Enter your event description here:</label><br />
    		<textarea id="postText">
    		</textarea><br />
    		<input type="submit" value="Add Event"/>
    	</form>
    </div>
  </body>
</html>