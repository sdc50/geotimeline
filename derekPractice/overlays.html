<!DOCTYPE html>
<html>
  <head>
    <title>Drawing tools</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
      html, body, #map-canvas{
        height: 100%;
        margin: 0px;
        padding: 0px
      }
      #map-canvas{
      	width: 50%;
      	display: inline-block;
      }
      #eventFormDiv{
      	height: 100%;
      	width: 48%;
      	display: inline-block;
      	background-color:#008000;
      	vertical-align: top;
      	margin: 0px;
      	padding: 0px;
      }
      #postText{
      	width: 80%;
      	height: 300px;
      	
      }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=drawing"></script>
    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
	<script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js">
		/*
		 * notes for running in virtual environment
		 * 
		 * cd the environment: cd C:\Python32\Scripts\geoTimelineEnv
		 * then:
		 *  Scripts\activate
		 *
		 * to run it:
		 * cd to the geotimeline:
		 * cd C:\Users\Derek\Documents\GitHub\geotimeline\GeoTimeline
		 * pserve development.ini --reload
		 */
	</script>
    <script>
    var drawingManager;
    var drawingsArray = [];
    var drawingsCount = -1;
    var loginName = 'testUser';
    var map;
    var mapOptions;
    
    
function initialize() {
  mapOptions = {
    center: new google.maps.LatLng(-34.397, 150.644),
    zoom: 8
  };


  map = new google.maps.Map(document.getElementById('map-canvas'),
    mapOptions);

  drawingManager = new google.maps.drawing.DrawingManager({
    drawingMode: google.maps.drawing.OverlayType.MARKER,
    drawingControl: true,
    drawingControlOptions: {
      position: google.maps.ControlPosition.TOP_CENTER,
      drawingModes: [
        google.maps.drawing.OverlayType.MARKER,
        //google.maps.drawing.OverlayType.CIRCLE,
        google.maps.drawing.OverlayType.POLYGON,
        google.maps.drawing.OverlayType.POLYLINE,
        //google.maps.drawing.OverlayType.RECTANGLE
      ]
    },
    markerOptions: {
      icon: 'flagPoint.jpg',
    },
    circleOptions: {
      fillColor: '#ffff00',
      fillOpacity: 0.5,
      strokeWeight: 2,
      clickable: false,
      editable: true,
      zIndex: 1
    },
    polygonOptions: {
		//path:myTrip,
  		strokeColor:"#0000FF",
  		strokeOpacity:0.8,
  		strokeWeight:2,
  		fillColor:"#0000FF",
  		fillOpacity:0.4
    }
  });
 
  drawingManager.setMap(map);
  $('#eventFormForm').hide();
  //After creating 'drawingManager' object in if block 
  google.maps.event.addListener(drawingManager, 'overlaycomplete', function(event) {
	//this was the original code example I got from:
	///(http://stackoverflow.com/questions/9853861/getting-list-of-overlay-shapes-currently-on-a-google-map-api-v3)
      /*if (event.type == google.maps.drawing.OverlayType.CIRCLE) {
         //Add 'event.overlay', which is Circle, to array
         drawingsArray.push(event.overlay);
      }*/
     //I altered it to a switch statement to get all of our shapes
     drawingManager.setOptions({drawingControl:false});
     drawingManager.setDrawingMode(null);
     switch(event.type)
     {
     	/*case google.maps.drawing.OverlayType.CIRCLE:
     	var newOv = event.overlay;
     	var newPath = newOv.getPath();
     	var encPath = google.maps.geometry.encoding.encodePath(newPath);
     	drawingsArray.push({
     		eventGroup: loginName,
     		eventTime: null,
     		eventCategory: null,
     		eventOverlay: event.overlay,
     		eventShape: 'circle',
     		eventTitle: null,
     		eventEncodedPath: newPath,
     	});
     	drawingsCount++;
     	break;*/
     	case google.maps.drawing.OverlayType.MARKER:
     	var newOv = event.overlay;
     	var newPos = newOv.getPosition();
     	var posArr = [];
     	var newLatLng = new google.maps.LatLng(newPos.k,newPos.A);
     	posArr.push(newLatLng);
     	var encPos = google.maps.geometry.encoding.encodePath(posArr);
     	drawingsArray.push({
     		eventGroup: loginName,
     		eventStart: null,
     		eventEnd: null,
     		eventCategory: null,
     		eventColor: null,
     		eventOverlay: event.overlay,
     		eventShape: 'marker',
     		eventTitle: null,
     		eventGeometry: encPos,
     	});
 		drawingsCount++;
     	break;
     	case google.maps.drawing.OverlayType.POLYGON:
     	var newOv = event.overlay;
     	var newPath = newOv.getPath();
     	var encPath = google.maps.geometry.encoding.encodePath(newPath);
     	drawingsArray.push({
     		eventGroup: loginName,
     		eventStart: null,
     		eventEnd: null,
     		eventCategory: null,
     		eventColor: null,
     		eventOverlay: event.overlay,
     		eventShape: 'polygon',
     		eventTitle: null,
     		eventGeometry: encPath,
     	});
     	drawingsCount++;
     	break;
     	case google.maps.drawing.OverlayType.POLYLINE:
     	var newOv = event.overlay;
     	var newPath = newOv.getPath();
     	var encPath = google.maps.geometry.encoding.encodePath(newPath);
     	drawingsArray.push({
     		eventGroup: loginName,
     		eventStart: null,
     		eventEnd: null,
     		eventCategory: null,
     		eventColor: null,
     		eventOverlay: event.overlay,
     		eventShape: 'polyline',
     		eventTitle: null,
     		eventGeometry: encPath,
     	});
     	drawingsCount++;
     	break;
     	/*case google.maps.drawing.OverlayType.RECTANGLE:
     	drawingsArray.push({
     		eventGroup: loginName,
     		eventTime: null,
     		eventCategory: null,
     		eventOverlay: event.overlay,
     		eventShape: 'rectangle',
     		eventTitle: null
     	});
     	drawingsCount++;
     	break;*/
     }
     //then I wrote this to bring up a form to make more additions to the event
     showEventForm();
  });

} 

function showEventForm(){
	$('#eventFormForm').show();
	$('#group').val(loginName);
	var geom = drawingsArray[drawingsCount].eventShape;
	$('#geometry').val(geom);
}
google.maps.event.addDomListener(window, 'load', initialize);

function showSubmission(){
	var x = $('#collectionInput').val();
	var z = $('#collections');
	var val = $(z).find('option[value="' + x + '"]');
	var endval = val.attr('id');
	alert("x: " + x + " z: " + z + " val: " + val + " endval: " + endval);
}

var mockList = [{
	name: 'collection1',
	id: '1'
	},
	{
	name: 'collection2',
	id: '2'
	},
	{
	name: 'collection3',
	id: '3'
	},
	{
	name: 'collection4',
	id: '4'
	}
];

function createDatalist(mockList){
	for(var l=0; l<mockList.length-1; l++){
		var listElement = mockList[l];
		var optionString = '<option value="' + listElement.name + '" id="' + listElement.id + '">';
		$('#collections').append(optionString);
	}
	
}
    </script>
  </head>
  <body>
    <div id="map-canvas">
    	<!--map goes here-->
    </div>
    <div id="eventFormDiv">
    	<form id="eventFormForm">
    		<!--  date time picker -->
    			<div id="datetimepicker" class="input-append date">
				    <input data-format="dd/MM/yyyy hh:mm:ss" type="text"></input>
				    <span class="add-on">
				      <i data-time-icon="icon-time" data-date-icon="icon-calendar">
				      </i>
				    </span>
				  </div>
				  <script type="text/javascript">
				  $(function() {
				    $('#datetimepicker').datetimepicker({
				      language: 'en',
				      pick12HourFormat: true
				    });
				  });
				</script>
    		<!--  end date time picker  -->
    		<label for="group">Login: </label>
    		<input type="text" id="group" /><br />
    		<label for="title">Event Title: </label>
    		<input type="text" id="title" /><br />
    		<label for="time">Date/Time: </label>
    		<input type="datetime" id="time"/><br />
    		<label for="geometry">Event Geometry: </label>
    		<select id="geometry">
    			<option value="prompt">Please Select A Geometry</option>
    			<option value="circle">circle</option>
    			<option value="marker">marker</option>
    			<option value="polyline">polyline</option>
    			<option value="polygon">polygon</option>
    			<option value="rectangle">rectangle</option>
    			<option value="none">none</option>
    		</select>
    		<!--  practicing using datalists -->
    		<input list="collections" id="collectionInput" />
    		<datalist id="collections">
    			<!-- <option value="c1" id="01">collection 1</option>
    			<option value="c2" id="02">collection 1</option>
    			<option value="c3" id="03">collection 1</option>
    			<option value="c4" id="04">collection 1</option>
    			<option value="c5" id="05">collection 1</option> -->
    		</datalist>
    		<!--  end practicing using datalists -->
    		<label for="category">Category: </label>
    		<select id="category">
    			<option value="prompt">Please Select A Category</option>
    			<option value="cat1">category 1</option>
    			<option value="cat2">category 2</option>
    			<option value="cat3">category 3</option>
    			<option value="new">NEW</option>
    		</select>
    		<input type="text" /><br />
    		<label for="postText">Enter your event description here:</label><br />
    		<textarea id="postText">
    		</textarea><br />
    		<input type="submit" value="Add Event"/>
    	</form>
    </div>
  </body>
  <script src="mockData.js"></script>
</html>